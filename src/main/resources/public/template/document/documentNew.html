<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="#{document.label.write}"></title>
    <th:block th:replace="layout/fragments/commonHead"></th:block>
</head>
<body>
<div>
    <h1 th:text="#{document.label.reg}"></h1>
    <hr>
    <table style="width:95%; margin: 0 auto;">
        <colgroup>
            <col width="20%">
            <col width="*">
        </colgroup>
        <tr>
            <th class="required" th:text="#{document.label.name}"></th>
            <td>
                <input id="document_name" type="text" maxlength="50" required="required" style="width:100%"/>
            </td>
        </tr>
        <tr>
            <th th:text="#{document.label.description}"></th>
            <td>
                <textarea id="document_desc" maxlength="128" style="height:100px; width:100%"></textarea>
            </td>
        </tr>
        <tr>
            <th class="required" th:text="#{document.label.form}"></th>
            <td>
                <select id="document_form" style="width:75%">
                    <option th:each="form:${formList}" 
                            th:id="${form?.id}"
                            th:value="${form?.id}"
                            th:text="#{${form?.name}}"></option>
                </select>
            </td>
        </tr>
        <tr>
            <th class="required" th:text="#{document.label.process}"></th>
            <td>
                <select id="document_process" style="width:75%">
                    <option th:each="process:${processList}"
                            th:id="${process?.id}"
                            th:value="${process?.id}"
                            th:text="#{${process?.name}}" ></option>
                </select>
            </td>
        </tr>
    </table>
</div>
<hr>
<div style="margin-top: 10px; text-align: center;">
    <button th:text="#{common.btn.register}" onclick="createDocument()"></button>
    <button th:text="#{common.btn.close}" onclick="window.close();"></button>
</div>
</body>
<script th:src="@{/assets/js/util/validation-alice.js}"></script>
<script type="text/javascript">
    function createDocument() {
        if (emptyValidation()) {
            let documentForm = document.getElementById('document_form');
        	let documentProcess = document.getElementById('document_process');
            const documentInfo = {
                documentName: document.getElementById('document_name').value,
                documentDesc: document.getElementById('document_desc').value,
                formId: documentForm.options[documentForm.selectedIndex].value,
                procId: documentProcess.options[documentProcess.selectedIndex].value,
            };
            restSubmit('POST', '/rest/documents', documentInfo);
        }
    }

    //빈 값 체크
    function emptyValidation() {
        if (isEmpty('document_name', 'document.msg.nameNotExist')) { return false; }
        return true;
    }

    //REST API
    function restSubmit(method, url, data) {
        const opt = {
            method: method,
            url: url,
            params: JSON.stringify(data),
            contentType: 'application/json',
            callbackFunc: function(response) {
                let documentId = response.responseText;
                opener.location.reload();
                window.close();
                const specs = "left=0,top=0,menubar=no,toolbar=no,location=no,status=no,titlebar=no,scrollbars=yes";
                window.open('/documents/display/' + documentId, '_blank', 'width=1500,height=920,' + specs);
            }
        };
        aliceJs.sendXhr(opt);
    }
</script>
</html>
