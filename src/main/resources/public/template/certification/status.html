<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="../../assets/js/util/util-alice.js"></script>
</head>
<body>
<div class="container">
    <div th:if="${validCode == 0 || validCode == 4}">
        <p>메일 인증 후 사용가능합니다.</p>
        <p>등록한 메일에서 인증을 진행해주세요.</p>
    </div>
    <div th:if="${validCode == 1}">
        <p>메일인증이 완료되었습니다.</p>
        <div sec:authorize="isAnonymous()">
            로그인이 필요합니다.
            <form th:action="@{/logout}" method="post">
                <label>
                    <input type="submit" th:value="LOGIN"/>
                </label>
            </form>
        </div>
        <div sec:authorize="isAuthenticated()">
            <a href="/document/documentSearch">메인화면으로 이동</a>
        </div>
    </div>
    <div th:if="${validCode == 2}">
        <p>이미 인증이 완료되었습니다.</p>
        <div sec:authorize="isAnonymous()">
            로그인이 필요합니다.
            <form th:action="@{/logout}" method="post">
                <label>
                    <input type="submit" th:value="LOGIN"/>
                </label>
            </form>
        </div>
        <div sec:authorize="isAuthenticated()">
            <a href="/document/documentSearch">메인화면으로 이동</a>
        </div>
    </div>
    <div th:if="${validCode == 3}">
        <p>인증코드가 잘못되었습니다.</p>
    </div>
    <div th:if="${validCode == 0 || validCode == 3 || validCode == 4}">
        <div sec:authorize="isAuthenticated()">
            <form id="sendForm" method="get" onsubmit="return false">
                <button id="btnSend" th:formaction="@{/certification/sendCertifiedMail}">인증메일 재요청</button>
            </form>
        </div>
        <div sec:authorize="isAnonymous()">
            <p>로그인 후 인증메일을 재요청하세요.</p>
        </div>
    </div>
</div>

</body>
<script type="text/javascript">
    /*<![CDATA[*/
    window.onload = function() {
        document.getElementById("btnSend").addEventListener("click", function() { restSubmit("get","[[@{/certification/sendCertifiedMail}]]"); });
    }

    function restSubmit(method, url) {
        var xmlhttp = createXmlHttpRequestObject(method, url);
        xmlhttp.open(method,url);
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == XMLHttpRequest.DONE) {
                if (xmlhttp.status == 200) {
                    alert("인증메일이 재발송되었습니다.");
                } else if (xmlhttp.status == 400) {
                    alert('There was an error 400');
                } else {
                    alert('something else other than 200 was returned');
                }
            }
        };
        xmlhttp.send(new FormData(document.getElementById("sendForm")));
    }
    /*]]>*/
</script>
</html>