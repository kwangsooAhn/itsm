<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="../../assets/js/util/util-alice.js"></script>
    <link th:href="@{/assets/vendors/gModal/css/gModal.css}" rel="stylesheet"/>
</head>
<body>
<div class="container">
    <div th:if="${validCode == 0 || validCode == 4}">
        <p th:utext="#{authentication.msg.beforeEmailCheck}"></p>
    </div>
    <div th:if="${validCode == 1}">
        <p th:text="#{authentication.msg.authenticationCompleted}"></p>
        <div sec:authorize="isAnonymous()">
            <p th:text="#{login.requiredLogin}"></p>
            <form th:action="@{/logout}" method="post">
                <label>
                    <input type="submit" th:value="LOGIN"/>
                </label>
            </form>
        </div>
        <div sec:authorize="isAuthenticated()">
            <a href="/tokens/search" th:text="#{login.gotoMainPage}"></a>
        </div>
    </div>
    <div th:if="${validCode == 2}">
        <p th:text="#{authentication.msg.alreadyAuthenticated}"></p>
        <div sec:authorize="isAnonymous()">
            <p th:text="#{login.requiredLogin}"></p>
            <form th:action="@{/logout}" method="post">
                <label>
                    <input type="submit" th:value="LOGIN"/>
                </label>
            </form>
        </div>
        <div sec:authorize="isAuthenticated()">
            <a href="/tokens/search" th:text="#{login.gotoMainPage}"></a>
        </div>
    </div>
    <div th:if="${validCode == 3}">
        <p th:text="#{authentication.msg.expiredAuthentication}"></p>
    </div>
    <div th:if="${validCode == 0 || validCode == 3 || validCode == 4}">
        <div sec:authorize="isAuthenticated()">
            <form id="sendForm" method="get" onsubmit="return false">
                <button id="btnSend" th:text="#{authentication.label.recallAuthentication}"
                        th:formaction="@{/certification/certifiedMail}"></button>
            </form>
        </div>
        <div sec:authorize="isAnonymous()">
            <p th:text="#{authentication.msg.recallAuthentication}"></p>
        </div>
    </div>
</div>

</body>
<script th:src="@{/assets/vendors/gModal/js/gModal.js}"></script>
<script type="text/javascript">
    /*<![CDATA[*/
    window.addEventListener('load', function () {
        document.getElementById("btnSend").addEventListener("click", function () {
            restSubmit("get", "[[@{/certification/certifiedMail}]]");
        });
    });


    function restSubmit(method, url) {
        const opt = {
            method: method,
            url: url,
            params: new FormData(document.getElementById("sendForm")),
            callbackFunc: function() {
                aliceJs.alert('[[#{authentication.msg.resentAuthentication}]]<br/>[[#{authentication.msg.emailCheck}]]');
            }
        };
        aliceJs.sendXhr(opt)
    }
    /*]]>*/
</script>
</html>
