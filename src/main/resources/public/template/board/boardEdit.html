<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
    layout:decorator="layout/defaultLayout">
<head>
    <title th:text="#{board.label.manager}"></title>
    <meta charset="UTF-8">
    <style>
        table {
            width: 100%;
            border: 1px solid;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table label {
            margin: 0;
        }
        table td {
            border: 1px solid;
            height: 50px;
        }
        table input, select {
            width: 90%;
            height: 24px;
        }
        table textarea {
            width: 100%;
        }
    </style>
</head>
<body>
<th:block layout:fragment="content">
    <div style="width: 70%; margin: 50px auto;">
        <div style="height: 90px;">
            <h1 th:text="#{board.label.manager}"></h1>
        </div>
        <hr>
        <table>
            <colgroup>
                <col width="20%">
                <col width="30%">
                <col width="20%">
                <col width="30%">
            </colgroup>
            <tbody>
                <tr>
                    <td><label th:text="#{board.label.board}"></label><span class="required"></span></td>
                    <td colspan="3">
                        <select th:if="${not #strings.isEmpty(boardCategoryInfo)}" id="boardCategory" style="width: 230px; height: 30px">
                            <option th:each="boardCategory: ${boardCategoryInfo}" th:value="${boardCategory.boardCategoryId}"
                                    th:text="#{${boardCategory.boardCategoryName}}"></option>
                        </select>
                        <input type="text" id="boardTitle" maxlength="100" th:value="${board?.boardTitle}">
                    </td>
                </tr>
                <tr>
                    <td><label th:text="#{board.label.contents}"></td>
                    <td colspan="3"><textarea id="boardConents" name="boardConents" maxlength="2048" rows="7" style="width: 750px; resize: none;" th:text="${board?.boardConents}"></textarea></td>
                </tr>
                <tr>
                    <td><label th:text="#{common.label.attachFile}"></label></td>
                    <td colspan="3">
                        <div id="dropZoneFiles"></div>
                        <div id="dropZoneUploadedFiles"></div>
                    </td>
                </tr>
                <tr>
                    <td><label th:text="#{common.label.createUserName}"></td>
                    <td><span id="spanCreateUserKey" name="spanCreateUserKey" th:text="${board?.createUser} ? ${board.createUser.userName} : ''"></span></td>
                    <td><label th:text="#{common.label.createDate}"></td>
                    <td><span id="spanCreateDt" name="spanCreateDt"
                              th:with="dateformat=${#authentication.details.timeFormat}"  th:text="${#temporals.format(board?.createDt,dateformat)}"></span></td>
                </tr>
                <tr>
                    <td><label th:text="#{common.label.updateUserName}"></td>
                    <td><span id="spanUpdateUserKey" name="spanUpdateUserKey" th:text="${board?.updateUser} ? ${board.updateUser.userName} : ''"></span></td>
                    <td><label th:text="#{common.label.updateDate}"></td>
                    <td><span id="spanUpdateDt" name="spanUpdateDt"
                              th:with="dateformat=${#authentication.details.timeFormat}" th:text="${#temporals.format(board?.updateDt,dateformat)}"></span></td>
                </tr>
            </tbody>
        </table>
        <table>
            <tr>
                <td><label th:text="#{board.label.comment}"></td>
                <td><input type="text" id="boardComments" name="boardComments" maxlength="100"></td>
                <td align="center"><button onclick="saveBoardComment('post')" th:text="#{common.btn.save}"></button></td>
            </tr>
            <div id="boardCommentList" style="margin-top: 20px"></div>
        </table>
        <div align="right">
            <button style="margin-right: 5px;" onclick="location.href='/boards/search'" th:text="#{common.btn.list}"></button>
            <button style="margin-right: 5px;" th:if="${board?.boardId}" onclick="saveBoard('put')" th:text="#{common.btn.modify}"></button>
            <button style="margin-right: 5px;" th:unless="${board?.boardId}" onclick="saveBoard('post')" th:text="#{common.btn.save}"></button>
            <button style="margin-right: 5px;" th:if="${board?.boardId}" onclick="saveBoardAnswer('post')" th:text="#{board.btn.answer}"></button>
            <button style="margin-right: 5px;" th:if="${board?.boardId}" onclick="deleteBoard('delete')" th:text="#{common.btn.delete}"></button>
        </div>
    </div>
</th:block>
</body>
<th:block layout:fragment="pageScript">
    <script th:src="@{/assets/js/util/validation-alice.js}"></script>
    <script th:inline="javascript" type="text/javascript">
        /*<![CDATA[*/
        window.onload = function() {
            if (/*[[${board?.boardId}]]*/ !== null) {
                fileUploader.init({extra: {formId: 'boardForm', ownId: [[${board?.boardId}]]}});
                getBoardCommentList();
            }
        };

        //게시판 저장
        function saveBoard(method) {
            if (isEmpty('boardTitle', 'board.msg.inputBoardTitle')) return;
            let fileSeqList = [];
            document.getElementsByName('fileSeq').forEach(function(elem) {
                fileSeqList.push(elem.value);
            });

            let boardCategoryId = '';
            if (/*[[${boardAdminInfo?.categoryYn}]]*/) {
                boardCategoryId = document.getElementById('boardCategory').value;
            }
            const data = {
                boardAdminId: /*[[${boardAdminInfo?.boardAdminId}]]*/,
                boardTitle: document.getElementById('boardTitle').value,
                boardConents: document.getElementById('boardConents').value,
                fileSeqList: fileSeqList,
                boardCategoryId: boardCategoryId
            };

            if (method === 'put') {
                data.boardId = /*[[${board?.boardId}]]*/;
            }
            restSubmit(method, '/rest/boards', data);
        }

        //게시판 답글
        function saveBoardAnswer(method) {
            alert("답글");
        }

        //게시판  삭제
        function deleteBoard(method) {
            restSubmit(method, '/rest/boards/' + /*[[${board?.boardId}]]*/);
        }

        //게시판 댓글 저장
        function saveBoardComment(method) {
            const data = {
                boardComments: document.getElementById('boardComments').value
            };
            restSubmit(method, '/rest/boards/'+/*[[${board?.boardId}]]*/+'/comment', data);
        }

        //게시판 댓글 조회
        function getBoardCommentList() {
            restSubmit('get', '/boards/'+/*[[${board?.boardId}]]*/+'/comments/list');
        }

        //게시판 댓글 삭제
        function boardCommentDelete() {
            restSubmit('delete', '/rest/boards/comments/'+/*[[${board?.boardId}]]*/);
        }

        //게시판 댓글 수정
        function openCommentEdit() {
            //밑에 row에 자동으로 무엇이 생기고 거기서 저장 할 수 있도록 구현
            alert("수정");
            //restSubmit('put', '/boards/'+/*[[${board?.boardId}]]*/+'/comments/list');
        }

        //REST API
        function restSubmit(method, url, data) {
            let resultMsg = '';
            if (method === 'put' || method === 'post') {
                resultMsg = i18n.get('common.msg.save');
            } else if (method === 'delete') {
                resultMsg = i18n.get('common.msg.delete');
            }
            const opt = {
                method: method,
                url: url,
                params: JSON.stringify(data),
                contentType: 'application/json',
                callbackFunc: function(response) {
                    if (method === 'put' || method === 'post' || method === 'delete') {
                        aliceJs.alert(resultMsg, function () {
                            location.href = '/boards/search';
                        });
                    } else if (method === 'get') {
                        document.getElementById('boardCommentList').innerHTML = response.responseText;
                    }
                }
            };
            aliceJs.sendXhr(opt);
        }
        /*]]>*/
    </script>
</th:block>
</html>