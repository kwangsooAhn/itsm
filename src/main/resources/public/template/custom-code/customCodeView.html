<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/itsm/pageType/commonViewLayout}">
<head>
    <title th:text="#{customCode.label.view}"></title>
</head>
<body>
<div layout:fragment="pageTitle">
    <h1 th:text="#{customCode.label.customCode}"></h1>
    <h6 class="description ml-2 pl-2" th:text="#{customCode.msg.viewDescription}"></h6>
</div>
<div layout:fragment="pageView">
    <div class="flex-column z-view-row">
        <label for="customCodeName" th:text="#{customCode.label.name}"></label>
        <input type="text" id="customCodeName" class="z-input" th:value="${customCode?.customCodeName}" disabled/>
    </div>
    <div class="flex-column z-view-row">
        <label th:text="#{customCode.label.type}"></label>
        <div class="flex-row mr-auto">
            <label class="z-radio" for="table" tabindex="0">
                <input id="table" name="type" type="radio"
                       th:checked="${customCode?.type == null || customCode?.type == 'table'}"
                       onclick="changeContainer('table')" disabled>
                <span></span>
                <span class="z-label mr-4" th:text="#{customCode.label.table}"></span>
            </label>
            <label class="z-radio" for="code" tabindex="0">
                <input id="code" name="type" type="radio"
                       th:checked="${customCode?.type == 'code'}" disabled>
                <span></span>
                <span class="z-label" th:text="#{customCode.label.code}"></span>
            </label>
        </div>
    </div>
    <!-- 타입: table-->
    <div id="type-table-container"
         th:style="${customCode?.type == null || customCode?.type == 'table' ? '' : 'display: none'}">
        <div class="flex-column z-view-row">
            <label>
                <span th:text="#{customCode.label.targetTable}"></span>
                <span class="required"></span>
            </label>
            <input type="text" class="z-input" th:value="|${customCode.targetTableName}(${customCode.targetTable})|"
                   disabled/>
        </div>
        <div class="flex-column z-view-row">
            <label>
                <span th:text="#{customCode.label.searchColumn}"></span>
                <span class="required"></span>
            </label>
            <input type="text" class="z-input" th:value="|${customCode.searchColumnName}(${customCode.searchColumn})|"
                   disabled/>
        </div>
        <div class="flex-column z-view-row">
            <label>
                <span th:text="#{customCode.label.valueColumn}"></span>
                <span class="required"></span>
            </label>
            <input type="text" class="z-input" th:value="|${customCode.valueColumnName}(${customCode.valueColumn})|"
                   disabled/>
        </div>
        <div class="flex-column z-view-row">
            <div class="under-bar">
                <label id="conditionLabel">
                    <span th:text="#{customCode.label.condition}"></span>
                </label>
                <button type="button" class="z-button-icon float-right" disabled>
                    <span class="z-icon i-plus"></span>
                </button>
            </div>
            <div id="condition"></div>
        </div>
    </div>
    <!-- 타입: 코드 -->
    <div id="type-code-container" th:style="${customCode?.type == 'code' ? '' : 'display: none'}">
        <div class="flex-column z-view-row">
            <label>
                <span th:text="#{customCode.label.pCode}"></span>
                <span class="required"></span>
            </label>
            <input type="text" id="pCode" class="z-input" maxlength="100" th:value="${customCode?.pCode}" disabled>
        </div>
    </div>
    <div class="flex-row justify-content-start z-view-row">
        <div class="z-button-list">
            <a class="z-button secondary" href="/custom-codes/search" th:text="#{common.btn.list}"></a>
        </div>
    </div>
</div>
</body>
<script layout:fragment="pageScript" th:inline="javascript" type="text/javascript">
    /*<![CDATA[*/
    window.onload = function () {
        if (/*[[${customCode.type == 'table'}]]*/'') {
            const condition = JSON.parse(/*[[${customCode.condition}]]*/'');
            if (condition != null) {
                Object.keys(condition).forEach(function (data) {
                    const divRow = document.createElement('div');
                    divRow.classList.add('flex-row', 'z-view-row');

                    const conditionInput = document.createElement('input');
                    conditionInput.classList.add('z-input', 'col-6');
                    conditionInput.type = 'text';
                    conditionInput.maxLength = 100;
                    conditionInput.value = getColumnName(condition[data].conditionKey);
                    conditionInput.disabled = true;

                    const equalSpan = document.createElement('span');
                    equalSpan.classList.add('equal', 'align-center', 'col-1');
                    equalSpan.value = getColumnName(condition[data].conditionOperator);
                    const operatorList = /*[[${operatorList}]]*/'';
                    for (let i = 0; i < operatorList.length; i++) {
                        if (equalSpan.value === operatorList[i].codeValue) {
                            equalSpan.textContent = operatorList[i].codeName;
                        }
                    }

                    const valueInput = document.createElement('input');
                    valueInput.classList.add('z-input', 'col-6');
                    valueInput.type = 'text';
                    valueInput.maxLength = 100;
                    valueInput.value = condition[data].conditionValue;
                    valueInput.disabled = true;

                    divRow.appendChild(conditionInput);
                    divRow.appendChild(equalSpan);
                    divRow.appendChild(valueInput);
                    document.getElementById('condition').appendChild(divRow);
                });
            }
        }
        // 스크롤바 추가
        OverlayScrollbars(document.querySelector('.edit'), {className: 'scrollbar'});
    };

    //Get Column Name
    function getColumnName(column) {
        const customCodeColumnList = /*[[${customCodeColumnList}]]*/'';
        for (let i = 0; i < customCodeColumnList.length; i++) {
            if (customCodeColumnList[i].customCodeColumn === column) {
                return customCodeColumnList[i].customCodeColumnName + '(' + column + ')';
            }
        }
        return column;
    }

    /*]]>*/
</script>
</html>
