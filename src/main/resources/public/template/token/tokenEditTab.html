<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
</head>
<body>
<div class="token-info-tab">
    <h4 class="align-center" data-target-contents="token-history" th:text="#{token.label.history}"></h4>
    <h4 class="align-center" data-target-contents="token-related" th:text="#{token.label.relatedInstance}"></h4>
    <h4 class="align-center" data-target-contents="token-comment" th:text="#{common.label.comment}"></h4>
    <h4 class="align-center" data-target-contents="token-tag" th:text="#{common.label.tag}"></h4>
</div>
<div class="token-info-contents">
    <div class="token-history">
        <table class="table table-hover">
            <thead>
            <tr>
                <th width="45%" th:text="#{token.label.startDt}">시작일시</th>
                <th width="40%" th:text="#{token.label.elementName}">업무</th>
                <th width="15%" th:text="#{token.label.assignee}">담당자</th>
            </tr>
            </thead>
            <tbody id="history" class="list-wrap">
            <tr th:each="tokenHistory : ${instanceHistory}">
                <td width="45%" class="user-date-time" th:name="tokenDt"
                    th:text="${tokenHistory.tokenStartDt}"/>
                <td width="40%" th:text="${tokenHistory.elementName}"></td>
                <td width="15%" th:text="${tokenHistory.assigneeName}"></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="token-related">
        <div class="list-item flex-row" th:each="rInstance: ${relatedInstance}">
            <div class="document-color" th:style="|background-color: ${rInstance.documentColor}|"></div>
            <div class="document-row flex-column">
                <div class="document-row-content flex-row justify-content-between">
                    <a th:onclick="openTokenEdit([[${rInstance.tokenId}]])">
                        <div class="document-title flex-row align-items-center">
                            <h5 th:text="${rInstance.documentName}"></h5>
                            <h5 th:text="${rInstance.documentNo}"></h5>
                        </div>
                    </a>
                    <button type="button"
                            th:onclick="aliceDocument.deleteRelatedDoc({folderId: [[${rInstance.folderId}]], instanceId: [[${rInstance.instanceId}]]})">
                        <span class="icon icon-delete"></span>
                    </button>
                </div>
                <div class="document-row-topic">
                    <h5 th:each="topic: ${rInstance.topics}" th:text="${topic}"></h5>
                </div>
                <div class="document-row-info flex-row align-items-center">
                    <div class="document-user flex-row align-items-center">
                        <img class="profile-photo mr-2" th:src="@{${rInstance.avatarPath}}" width="32" height="32"/>
                        <h5 th:text="${rInstance.instanceCreateUserName}"></h5>
                    </div>
                    <span class="vertical-bar"></span>
                    <h5 class="dateFormatFromNow" th:text="${rInstance.instanceStartDt}"></h5>
                    <span class="vertical-bar"></span>
                    <h5 th:text="#{|common.code.token.status.${rInstance.instanceStatus}|}"></h5>
                </div>
            </div>
        </div>
        <div class="related-add justify-content-center align-items-center">
            <button th:onclick="openRelatedToken([[${tokenId}]])">
                <span class="icon-plus"></span>
            </button>
        </div>
    </div>
    <div id="commentList" class="token-comment">
        <div class="list-item flex-column" th:each="comment : ${commentList}">
            <div class="comment-row-info flex-row align-items-center">
                <div class="comment-user flex-row align-items-center">
                    <img class="profile-photo mr-2" th:src="@{${comment.avatarPath}}" width="32" height="32"/>
                    <h5 class="user-name" th:text="${comment.createUserName}"></h5>
                </div>
                <h5 class="user-date-time" th:text="${comment.createDt}"></h5>
                <div th:if="${#authentication.details.userKey} == ${comment.createUserKey}">
                    <button th:attr="onclick=|aliceDocument.deleteComment('${comment.commentId}')|">
                        <span class="icon icon-delete"></span>
                    </button>
                </div>
            </div>
            <div class="comment-row">
                <span class="auto-break space-line" th:text="${comment.content}"></span>
            </div>
        </div>
        <div id="comment-container" class="comment comment-input flex-row align-items-start"></div>
    </div>
    <div class="token-tag">
        <div class="tag-input">
            <input name="tags" id="tags" th:value="|${tagList}|"/>
        </div>
    </div>
</div>
</body>
</html>
