<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="formDesigner/formCore">
<head>
    <title th:text="#{token.label.view}"></title>
</head>
<th:block layout:fragment="css">
    <link th:href="@{/assets/css/document.css}" rel="stylesheet"/>
    <link th:href="@{/assets/theme/{theme}/css/itsm.css(theme=${#authentication.details.theme})}" rel="stylesheet"/>
</th:block>
<body>
<th:block layout:fragment="content">
    <div class="z-document-container">
        <form id="frm" name="frm">
            <div class="z-document-main flex-column align-items-center">
                <input type="hidden" id="instanceId" />
                <input type="hidden" id="tokenId" th:value="${tokenId}"/>
                <input type="hidden" id="folderId" th:value="${folderId}"/>
                <div class="z-document-main-header flex-row justify-content-between align-items-center flex-wrap">
                    <span class="z-document-numbering" th:text="|#{document.label.docNo} : ${documentNo}|"></span>
                    <div id="defaultButtonArea"></div>
                    <div class="z-action-button-top-area" id="actionButtonTopArea"></div>
                </div>
                <div class="z-drawing-board" id="documentDrawingBoard" data-display="running"></div>
                <div class="z-document-main-footer flex-row justify-content-end align-items-center flex-wrap">
                    <div class="z-action-button-bottom-area" id="actionButtonBottomArea"></div>
                </div>
            </div>
        </form>
        <!-- 탭 영역 -->
        <div class="z-token-properties flex-column" id="documentProperties">
            <div class="z-token-tabs">
                <h5 class="z-token-tab align-center pointer active" data-target-contents="tokenInformation" th:text="#{token.label.information}"></h5>
                <h5 class="z-token-tab align-center pointer" data-target-contents="tokenComment" th:text="#{common.label.comment}"></h5>
                <h5 class="z-token-tab align-center pointer" data-target-contents="tokenTag" th:text="#{common.label.tag}"></h5>
            </div>
            <div class="z-token-panels">
                <div class="z-token-panel on" id="tokenInformation">
                    <!-- 문서이력 -->
                    <div class="z-token-history">
                        <label class="z-token-history-sub-title" th:text="#{token.label.history}"></label>
                        <table class="z-token-history-table">
                            <thead>
                            <tr class="flex-row align-items-center">
                                <th style="width: 35%;" class="align-left" th:text="#{token.label.startDt}"></th>
                                <th style="width: 25%;" class="align-left" th:text="#{token.label.elementName}"></th>
                                <th style="width: 20%;" class="align-left" th:text="#{token.label.assignee}"></th>
                                <th style="width: 20%;" class="align-left" th:text="#{token.label.process}"></th>
                            </tr>
                            </thead>
                            <tbody id="history">
                            <tr class="flex-row align-items-center"></tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- 관련문서 -->
                    <div class="z-token-related" id="related">
                        <label class="z-token-related-sub-title" th:text="#{token.label.relatedInstance}"></label>
                        <div class="z-token-related-item flex-row justify-content-center align-items-center z-document-add">
                            <button class="z-button-icon" th:onclick="zFormTokenTab.openRelatedDocModal()">
                                <span class="z-icon i-plus"></span>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- 댓글 -->
                <div class="z-token-panel z-token-comment" id="tokenComment">
                    <div class="z-comment-add flex-row align-items-start">
                        <textarea id="commentValue" class="z-textarea textarea-scroll-wrapper flex-fill mr-1" maxlength="200" rows="2" th:placeholder="#{comment.msg.enterComments}"></textarea>
                        <button class="z-button secondary" th:onclick="zFormToken.saveComment()" th:text="#{common.btn.register}" th:disabled="${mode == 'view'}"></button>
                    </div>
                </div>
                <!-- 태그 -->
                <div class="z-token-panel z-token-tag" id="tokenTag">
                    <div class="tag-input">
                        <input type="text" class="z-input" id="tokenTags" th:readonly="${mode == 'view'}" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</th:block>
</body>
<th:block layout:fragment="script">
    <script type="module">
        /*<![CDATA[*/
        import { zFormToken } from "../../assets/js/document/zFormToken.js";
        import { zFormButton } from "../../assets/js/document/zFormButton.js";
        import { SESSION } from '../../assets/js/lib/zConstants.js';
        import { zFormTokenTab } from "../../assets/js/document/zFormTokenTab.js";

        const userSession = {
            userKey : '[[${#authentication.details.userKey}]]',
            userId : '[[${#authentication.details.userId}]]',
            userName: '[[${#authentication.details.userName}]]',
            email: '[[${#authentication.details.email}]]',
            position: '[[${#authentication.details.position}]]',
            department: '[[${#authentication.details.department}]]',
            officeNumber: '[[${#authentication.details.officeNumber}]]',
            mobileNumber: '[[${#authentication.details.mobileNumber}]]'
        };
        Object.assign(SESSION, userSession);

        // 문서 생성
        aliceJs.fetchJson('/rest/tokens/' + '[[${tokenId}]]' + '/data', {
            method: 'GET'
        }).then((formDataJson) => {
            document.getElementById('instanceId').value = formDataJson.instanceId;
            formDataJson.tokenId = document.getElementById('tokenId').value;
            formDataJson.folderId = document.getElementById('folderId').value;

            zFormToken.init(formDataJson, false);
            zFormButton.init(formDataJson, zFormToken);
            zFormTokenTab.init(formDataJson, false);

            window.zFormToken = zFormToken;
            window.zFormTokenTab = zFormTokenTab;
        });
        /*]]>*/
    </script>
</th:block>
</html>
