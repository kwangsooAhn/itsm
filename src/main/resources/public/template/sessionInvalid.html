<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <style type="text/css">
        body { text-align: center; }
    </style>
</head>
<body>
<img th:src="@{/assets/media/image/session_id.jpg}"/>
<h3>[[#{login.msg.sessionExpired}]]</h3>
<h3><span id="counter"></span></h3>
<button type="button" id="gotoLoginPage" th:text="#{login.gotoLoginPage}"/>
<form id="logoutForm" name="logoutForm" th:action="@{/logout}" method="post"></form>
<script type="text/javascript" th:inline="javascript">
    window.onload = function() {
        /*<![CDATA[*/
        let count = [[${counter}]],
            timer,
            counterMsg = [[#{login.msg.redirectedLoginPage}]];

        setCounterMsg(count);
        document.querySelector('#gotoLoginPage').addEventListener('click', gotoLoginPage);
        const counting = function() {
            clearTimeout(timer);
            if (count !== 1) {
                count -= 1;
                setCounterMsg(count);
                timer = setTimeout(counting, 1000);
            } else {
                gotoLoginPage();
            }
        };
        timer = setTimeout(counting, 1000);

        function setCounterMsg(count) {
            document.querySelector('#counter').textContent = counterMsg.replace('{0}', count);
        }

        function gotoLoginPage() {
            clearTimeout(timer);
            const logoutForm = document.getElementById('logoutForm');
            if (window.opener !== null) {
                window.opener.name = 'alice_web';
                logoutForm.target = window.opener.name;
            }
            logoutForm.submit();
            if (window.opener !== null) {
                window.close();
            }
        }
    }
    /*]]>*/
</script>
</body>
</html>