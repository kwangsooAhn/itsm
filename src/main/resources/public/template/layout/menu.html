<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>Insert title here</title>
    </head>
    <body>

        <div>
            <ul id="userMenus"></ul>
        </div>

        <a href="/layout/menuTest">메뉴이동</a>
        <a href="/notices/list">공지사항</a>
        <a href="/faqs/search">FAQ</a>
        <a href="/roles/form">역할 CRUD</a>
        <a href="/process/list">프로세스목록</a>
        <a href="/document/list">문서양식 목록</a>
        <a href="/exception/list">예외처리</a>
        <a href="/files">파일업로드</a>
        <form id="logoutForm" name="logoutForm" th:action="@{/logout}" method="post">
            <a href="javascript:logout()">로그아웃</a>
        </form>
        <div style="border: 1px solid red"></div>
    </body>
    <script type="text/javascript" th:inline="javascript">
        /*<![CDATA[*/
        var menuList = [];

        /*[# th:each="menu : ${#authentication.details.menus}"]*/
        var parentMenuId = /*[[${menu.pMenuId}]]*/'부모메뉴아이디';
        var menuId = /*[[${menu.menuId}]]*/'메뉴아이디';
        menuList.push(menuId);

        /*[# th:if="menu.pMenuId != 'menu'"]*/
        var menuUrl = /*[[${menu.url}]]*/'메뉴경로';
        var menuName = /*[[#{|menu.${menu.menuId}|}]]*/'메뉴명';

        var ul = '';
        var li = '';

        if (menuList.includes(parentMenuId)) {
            ul = document.getElementById(parentMenuId)

        } else {
            ul = document.createElement('ul');
            ul.id = menuId;
        }

        console.debug(parentMenuId.split('.'))
        console.debug(parentMenuId.split('.').length)

        if (menuUrl !== '') {

            docDiv.innerText = /*[[#{|menu.${menu.menuId}|}]]*/'메뉴이름';
            docDiv.style.cursor = 'pointer';
            document.getElementById('userMenus').appendChild(docDiv);

        }


        // if (menuUrl !== '') {
        //     docDiv.addEventListener('click', function (e) {
        //         const xhr = new XMLHttpRequest();
        //         xhr.onreadystatechange = function () {
        //             if (this.readyState === 4 && this.status === 200) {
        //                 const contents = document.getElementById('contents');
        //                 contents.innerHTML = this.responseText;
        //                 const myScripts = contents.getElementsByTagName("script");
        //                 if (myScripts.length > 0) {
        //                     Function(myScripts[0].innerHTML)();
        //                 }
        //             } else if (this.readyState === 4 && this.status !== 200) {
        //                 aliceJs.xhrErrorResponse('layoutError', this.responseText);
        //             }
        //         }
        //         xhr.onerror = function () {
        //             aliceJs.xhrErrorResponse('layoutError', this.responseText);
        //         };
        //         xhr.open('get', menuUrl, true);
        //         xhr.send();
        //     });
        // }
        /*[/]*/
        /*[/]*/
        /*]]>*/

        function logout() {
            document.getElementById("logoutForm").submit();
        }
    </script>
</html>
