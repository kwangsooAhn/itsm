<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>사용자데이터</title>
</head>
<body>
<div sec:authorize="hasAuthority('user.read')" th:unless="${#lists.isEmpty(users)}">
    <table class="table table-hover">
        <thead>
        <tr>
            <th th:text="#{user.id}">아이디</th>
            <th th:text="#{user.name}">이름</th>
            <th th:text="#{user.department}">부서</th>
            <th th:text="#{user.position}">직책</th>
            <th th:text="#{user.extensionNumber}">내선번호</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="user : ${users}" data-toggle="modal" data-target="#userDetailModal" th:data-id="${user.userId}">
            <td th:text="${user.userId}">사용자 아이디</td>
            <td th:text="${user.userName}">사용자 이름</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
        </tr>
        </tbody>
    </table>
</div>

<div id="saveResult"></div>

<!-- Modal -->
<div class="modal fade" id="userDetailModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-body" id="userDetail"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" th:text="#{btn.close}">닫기</button>
                <button type="button" class="btn btn-default btn-save" th:text="#{btn.save}">저장</button>
            </div>
        </div>

    </div>
</div>


<script type="text/javascript" th:inline="javascript">
    $(document).ready(function () {

        /**
         * 모달 닫기
         */
        $('#userDetailModal').on('hidden.bs.modal', function (e) {
            $('#userDetail').empty();
        });

        /**
         * 모달 열기
         */
        $('#userDetailModal').on('show.bs.modal', function (e) {
            $.ajax({
                type: "get",
                url: '/users/' + $(e.relatedTarget).data('id'),
                success: function (user) {
                    $.ajax({
                        type: 'get', url: '/users/detail', data: {user: JSON.stringify(user)}
                    }).done(function (data) {
                        $('#userDetail').html(data)

                    });
                },
                error: function (request, status, error) {
                    alert("Call failed. code : " + request.status + ", message : " + request.errorMsg);
                }
            });
        });

        /**
         * 저장하기
         */
        $('#userDetailModal').on('click', '.btn-save', function(){
            $.ajax({
                type: "put",
                url: '/users/' + $('#userDetailEditModal #userId').val(),
                data: $('#userDetailEditModal').serializeObject(),
                success: function (response) {
                    $('#userDetailModal').modal('hide');
                    $('#saveResult').html(response)

                },
                error: function (request, status, error) {
                    alert("Call failed. code : " + request.status + ", message : " + request.errorMsg);
                }
            });
        });


    })


</script>
</body>
</html>