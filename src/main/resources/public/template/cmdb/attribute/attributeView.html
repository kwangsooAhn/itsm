<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/itsm/pageType/commonViewLayout}">
<head>
    <title th:text="#{cmdb.attribute.label.view}"></title>
</head>
<body>
<div layout:fragment="pageTitle">
    <h1 th:text="#{cmdb.attribute.label.view}"></h1>
    <h6 class="description ml-2 pl-2" th:text="#{cmdb.attribute.msg.viewDescription}"></h6>
</div>
<div layout:fragment="pageView">
    <input type="hidden" id="attributeId" name="attributeId" th:value="${attribute?.attributeId}"/>
    <div class="flex-column z-view-row">
        <label for="attributeName">
            <span th:text="#{cmdb.attribute.label.name}"></span>
            <span class="required"></span>
        </label>
        <input type="text" id="attributeName" class="z-input" required="required" maxlength="100"
               th:value="${attribute?.attributeName}" disabled/>
    </div>
    <div class="flex-column z-view-row">
        <label for="attributeDesc">
            <span th:text="#{cmdb.attribute.label.description}"></span>
        </label>
        <textarea id="attributeDesc" name="attributeDesc" class="z-textarea textarea-scroll-wrapper"
                  maxlength="250" rows="5" th:text="${attribute?.attributeDesc}" disabled></textarea>
    </div>
    <div class="flex-column z-view-row">
        <label for="attributeText">
            <span th:text="#{cmdb.attribute.label.label}"></span>
        </label>
        <input type="text" id="attributeText" class="z-input" maxlength="100"
               th:value="${attribute?.attributeText}" disabled/>
    </div>
    <div class="flex-column z-view-row">
        <label for="attributeType">
            <span th:text="#{cmdb.attribute.label.type}"></span>
            <span class="required"></span>
        </label>
        <select id="attributeType" disabled>
        </select>
    </div>
    <div class="flex-column z-view-row">
        <div class="under-bar">
            <label th:text="#{cmdb.attribute.label.details}"</label>
        </div>
        <div id="details"></div>
    </div>
    <div class="flex-row justify-content-start z-view-row">
        <div class="z-button-list">
            <a class="z-button secondary" href="/cmdb/attributes/search" th:text="#{common.btn.list}"></a>
        </div>
    </div>
</div>
</body>
<th:block layout:fragment="pageScript">
    <script th:src="@{/assets/js/workflow/zWorkflowUtil.js}"></script>
    <script th:src="@{/assets/js/cmdb/zCmdbAttribute.js}"></script>
    <script type="text/javascript" th:inline="javascript">
        /*<![CDATA[*/
        const attributeData = /*[[${attribute?.attributeValue}]]*/ null;
        window.onload = function () {
            const attributeType = /*[[${attribute?.attributeType}]]*/ null;
            let attributeTypeObject = document.querySelector('#attributeType');
            for (let i = 0; i < zCmdbAttribute.attributeTypeList.length; i++) {
                const option = document.createElement('option');
                option.text = zCmdbAttribute.attributeTypeList[i].name
                option.value = zCmdbAttribute.attributeTypeList[i].type
                if (attributeType != null && option.value === attributeType) {
                    option.setAttribute('selected', 'true');
                }
                attributeTypeObject.add(option);
            }

            // Attribute Details
            zCmdbAttribute.init(document.querySelector('#details'));
            changeType(attributeTypeObject, true);

            aliceJs.initDesignedSelectTag();

            const detailObject = document.querySelector('#details');
            detailObject.querySelectorAll('input').forEach(function(object) { object.disabled = true; });
            detailObject.querySelectorAll('select').forEach(function(object) { object.disabled = true; });
            detailObject.querySelectorAll('button').forEach(function(object) { object.disabled = true; });
            detailObject.querySelectorAll('.z-select-box').forEach(function(object) { object.classList.add('disabled-select')});
            detailObject.querySelectorAll('button').forEach(function(object) { object.remove('.z-button.icon') });

            OverlayScrollbars(document.querySelectorAll('.edit'), { className: 'scrollbar' });
            OverlayScrollbars(document.querySelectorAll('.textarea-scroll-wrapper'), {
                className: 'scrollbar',
                textarea: {
                    dynHeight: false,
                    dynWidth: false,
                    inheritedAttrs: "class"
                }
            });
        };

        function changeType(object, isInit) {
            let data = null;
            if (isInit) {
                data = JSON.parse(attributeData);
            }
            zCmdbAttribute.makeDetails(object.value, data);
        }
        /*]]>*/
    </script>
</th:block>
</html>
