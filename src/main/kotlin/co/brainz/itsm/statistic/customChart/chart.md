# 사용자 정의 차트

## 차트를 이루는 구성요소

---

일반적으로 차트는 종류별로 약간의 차이는 있지만 공통적으로 아래와 같은 요소를 필요로 한다.

### 데이터 항목

HighCharts에서 시리즈라고 부르는 항목이다. 
예를 들어 1년치 신청서를 `장애신고`, `단순문의`, `변경요청`으로 구분해서 월별로 변화량을 라인차트로 출력한다면 `장애신고`, `단순문의`, `변경요청` 각각이 시리즈, 즉 데이터 항목이라고 할 수 있다.

### 기간

대상이 되는 데이터의 수집기간을 뜻한다. 기간에 포함되는 날짜는 해당 데이터의 특정 속성(`완료일자`,`신청일자`)를 기준으로 계산한다.

### 간격

수집되는 데이터는 특정 기간내에 포함되면 수집되는 단위 기간을 가진다. 즉, 같은 1년치 데이터라도 일별로 보느냐 1개월단위로 보느냐를 결정할 수 있다.

### 값

실제 해당 시점에 구해진 데이터를 뜻한다. 

## ITSM에서 설정 요소

---

위에서 정리된 일반적인 차트의 구성요소는 ITSM에서 아래와 같은 설정 항목을 통해서 설정된다.

### 수집대상 태그

차트를 구하기 위해서 대상이 되는 인스턴스를 검색하기 위해서 사용된다. 수집대상 태그중에 1개 이상의 태그가 포함된 문서양식을 대상으로 해당 문서를 이용해서 진행된 인스턴스를 검색하는 식이다.

또한, 차트의 데이터항목을 설정하는 역할을 한다. 해당 태그가 있는 컴포넌트의 값에 따라 데이터 항목을 분류해서 사용한다.

따로 설정이 없어도 기본적으로 "취소"된 문서외에 모든 완료상태의 문서만을 대상으로 한다.

### 연산 대상 태그

실제 값을 추출하기 위한 대상 태그를 지정한다. 차트에 사용되는 값은 단순히 카운트부터 퍼센트, 평균등의 계산을 하게 되는데 이 대상이 되는 컴포넌트 태그를 설정한다.

### 연산

`수집대상 태그`에서 수집 대상이 되는 문서들을 추출하고 `연산대상 태그`에서 설정된 컴포넌트들을 구해서 실제 어떤 연산으로 최종 값을 구할지 결정하는 설정항목이다.

* 카운트 : `연산대상 태그`가 포함된 컴포넌트의 갯수를 나타낸다.
* 퍼센트 : `수집대상 태그`의 값에 따라 퍼센트를 구한다.
* 평균 : `연산대상 태그`가 포함된 컴포넌트의 값의 평균을 구한다. 이때 기준은 `간격`항목에서 설정된 값을 이용해서 평균을 구한다.

### 기간

* 차트의 기간과 동일한 의미이다.
* 사용자가 고정된 기간을 입력할 수도 있으며, 차트가 생성되는 시점을 기준으로 `지난 달`, `어제`와 같은 설정이 가능하다.

### 간격

* `기간`에서 설정된 내용을 어떤 간격으로 보여줄 지 결정하는 설정이다.
* `년`, `월`, `일`과 같은 기준을 가질 수 있다.

### 그룹


## 실제 차트 데이터를 구하는 절차

---

설정된 내용을 바탕으로 차트를 구하는 절차는 아래와 같다.

### 1. 대상 문서 검색
* `수집대상 태그`에서 설정된 태그들을 포함하는 문서양식들을 구한다.
* 해당 문서양식을 사용한 업무흐름 인스턴스 리스트를 구한다.
* 이때 해당 인스턴스는 `취소`가 아닌 정상적인 `종료`와 `종결` 상태를 대상으로 한다.
* 인스턴스의 종료일자를 기준으로 `기간` 설정 값을 적용해서 인스턴스를 검색한다.

### 2. 데이터 식별
* 위에서 구한 인스턴스들에서 `수집대상 태그`가 붙어 있는 컴포넌트들의 값들을 구한다.
* 해당 값들을 키 값으로 시리즈명으로 사용한다.

### 3. 데이터 항목 검색
* 위에서 추출한 인스턴스를 대상으로 `연산대상 태그`가 붙어 있는 컴포넌트의 값들을 추출한다.

### 4. 데이터 연산
* 위에서 추출된 컴포넌트의 실제 값을 가지고 연산을 수행한다.
* 이때 `간격` 설정에 입력된 값을 기준으로 사용한다.

### 5. 차트별 데이터 포맷 생성
* 최종적으로 구해진 데이터는 각 차트에서 필요로 하는 설정파일로 구성되어 진다.

## 차트 종류별 설정 요소 

---
